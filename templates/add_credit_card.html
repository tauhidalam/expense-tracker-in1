{% extends "base.html" %}

{% block content %}
    <h2>Add Credit Card</h2>
    <form method="POST" action="">
        {{ form.hidden_tag() }}
        
        <div class="form-group">
            {{ form.name.label(class="form-control-label") }}
            {{ form.name(class="form-control") }}
            {% for error in form.name.errors %}
                <div class="alert alert-danger">{{ error }}</div>
            {% endfor %}
        </div>
        
        <div class="form-group">
            {{ form.credit_limit.label(class="form-control-label") }}
            {{ form.credit_limit(class="form-control") }}
            {% for error in form.credit_limit.errors %}
                <div class="alert alert-danger">{{ error }}</div>
            {% endfor %}
        </div>
        
        <div class="form-group">
            {{ form.submit(class="btn btn-primary") }}
        </div>
    </form>

    <h2 class="mt-5">Existing Credit Cards & Transactions</h2>
    <table class="table table-striped mt-3">
        <thead>
            <tr>
                <th>Name</th>
                <th>Credit Limit (₹)</th>
                <th>Available Limit (₹)</th>
                <th>Outstanding Balance (₹)</th>
                <th>Expenses</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for credit_card in credit_cards %}
            <div class="card">
                <h4>{{ credit_card.name }}</h4>
                <p>Credit Limit: {{ credit_card.credit_limit }}</p>
                <p>Available Limit: {{ credit_card.available_limit }}</p>
                <p>Outstanding Balance: {{ credit_card.outstanding }}</p>
        
                <!-- Form for resetting outstanding balance -->
                <form method="POST" action="">
                    <input type="hidden" name="reset_outstanding" value="{{ credit_card.id }}">
                    <button type="submit" class="btn btn-warning">Reset Outstanding</button>
                </form>
        
                <!-- Form for deleting the credit card -->
                <form method="POST" action="">
                    <input type="hidden" name="delete_credit_card" value="{{ credit_card.id }}">
                    <button type="submit" class="btn btn-danger">Delete Card</button>
                </form>
            </div>
        {% endfor %}                        </ul>
                    </td>
                    <td>
                        <!-- Form to reset outstanding balance -->
                        <form method="POST" action="{{ url_for('add_credit_card') }}" style="display:inline;" onsubmit="return confirmResetOutstanding();">
                            {{ form.hidden_tag() }}
                            <input type="hidden" name="reset_outstanding" value="{{ card.id }}">
                            <button type="submit" class="btn btn-danger btn-sm">Reset Outstanding</button>
                        </form>
                    </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>

    <script>
        function confirmResetOutstanding() {
            return confirm('Are you sure you want to reset the outstanding balance? This action cannot be undone.');
        }
    </script>
{% endblock %}
